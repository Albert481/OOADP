<!DOCTYPE html>
<html lang="en">

<head>
    <title>
        <%= title %>
    </title>
    <script src="/javascripts/socket.io.js"></script>
    <% include ../partials/javascript.ejs %>
    <% include ../partials/stylesheet %>
    <link rel="stylesheet" href="/stylesheets/chatmessage.css">
</head>

<body>
    <div id="frame">
        <div id="sidepanel">
            <div id="profile">
                <div class="wrap">
                    <img id="profile-img" src="http://emilcarlsson.se/assets/mikeross.png" class="online" alt="" />
                    <p> <%= user.name %> </p>
                    <i class="fa fa-chevron-down expand-button" aria-hidden="true"></i>
                    <div id="status-options">
                        <ul>
                            <li id="status-online" class="active"><span class="status-circle"></span> <p>Online</p></li>
                            <li id="status-away"><span class="status-circle"></span> <p>Away</p></li>
                            <li id="status-busy"><span class="status-circle"></span> <p>Busy</p></li>
                            <li id="status-offline"><span class="status-circle"></span> <p>Offline</p></li>
                        </ul>
                    </div>
                    <div id="expanded">
                        <label for="twitter"><i class="fa fa-facebook fa-fw" aria-hidden="true"></i></label>
                        <input name="twitter" type="text" value="mikeross" />
                        <label for="twitter"><i class="fa fa-twitter fa-fw" aria-hidden="true"></i></label>
                        <input name="twitter" type="text" value="ross81" />
                        <label for="twitter"><i class="fa fa-instagram fa-fw" aria-hidden="true"></i></label>
                        <input name="twitter" type="text" value="mike.ross" />
                    </div>
                </div>
            </div>
            <div id="search">
                <label for=""><i class="fa fa-search" aria-hidden="true"></i></label>
                <input type="text" placeholder="Search contacts..." />
            </div>
            <div id="contacts">
                <ul>
                    <% userchannel.forEach(function(userch) { %>
                    <li class="contact">
                        <div class="wrap">
                            <span class="contact-status online"></span>
                            <img src="http://emilcarlsson.se/assets/louislitt.png" alt="" />
                            <div class="meta">
                                <p class="name"> <%= userch.name %> </p>
                                <p class="preview">You just got LITT up, Mike.</p>
                            </div>
                        </div>
                    </li>
                    <%})%>
                </ul>
            </div>
            <div id="bottom-bar">
                <button id="addcontact"><i class="fa fa-user-plus fa-fw" aria-hidden="true"></i> <span>Add contact</span></button>
                <button id="settings"><i class="fa fa-cog fa-fw" aria-hidden="true"></i> <span>Settings</span></button>
            </div>
        </div>
        <div class="content">
            <div class="contact-profile">
                <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
                <p> <%= user.name %> </p>
            </div>
            <div class="messages" id="messages">
                <ul id="inlineMessage">
                    <li class="sent">
                        <p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
                    </li>
                    <li class="replies">
                        <p>When you're backed against the wall, break the god damn thing down.</p>
                    </li>
                    <% data.forEach(function(msg) { %> 
                    <li class="replies">
                            <p> <%=msg.message %> </p>
                            <p> <%=msg.timestamp %> </p>
                    </li>
                    <%})%>
                </ul>
            </div>
            <div class="message-input">
                <div class="wrap">
                <input id="message" type="text" placeholder="Write your message..." name="inputMessage"/>
                <i class="fa fa-paperclip attachment" aria-hidden="true"></i>
                <button id="send" class="submit"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                </div>
            </div>
        </div>
    </div>
</body>
    


<script>
    $(function(){
        var $h3s = $('li').click(function(){
            $h3s.removeClass('active');
            $(this).addClass('active');
        });
    });
    var socket = io()
    $(() => {
        $("#send").click(() => {
            var message = { message: $("#message").val() }
            postMessage(message)
        })
    })

    socket.on('message', addMessage)

    function addMessage(msg) {
        $("#inlineMessage").append(`<li class="replies">
                            <p> ${msg.message} </p>
                            <p> ${msg.timestamp} </p>
                    </li>`)
    }

    function postMessage(message) {
        $.post('<%=url%>', message)
    }

    socket.emit('subscribe', conversation_id);

    socket.emit('send message', {
        room: conversation_id,
        message: "Some message"
});

socket.on('conversation private post', function(data) {
    //display data.message
});
</script>


<footer>
    <% include ../partials/javascript %>
</footer>

</body>

</html>